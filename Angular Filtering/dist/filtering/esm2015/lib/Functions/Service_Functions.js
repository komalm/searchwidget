export function UpdateConfig({ apiData, addtionalFilterConfig, filterConfig, }) {
    let TempData = apiData;
    if ((filterConfig === null || filterConfig === void 0 ? void 0 : filterConfig.length) !== 0) {
        filterConfig === null || filterConfig === void 0 ? void 0 : filterConfig.map((item) => {
            const ItemName = item.name;
            const ItemField = item.field;
            const ItemIsEnabled = item.isEnabled !== undefined ? item.isEnabled : true;
            TempData[0].data.PrimaryFields[ItemName] = {
                field: ItemField,
                isEnabled: ItemIsEnabled,
            };
        });
    }
    if ((addtionalFilterConfig === null || addtionalFilterConfig === void 0 ? void 0 : addtionalFilterConfig.length) !== 0) {
        addtionalFilterConfig === null || addtionalFilterConfig === void 0 ? void 0 : addtionalFilterConfig.map((item) => {
            const ItemName = item.name;
            const ItemField = item.field;
            const ItemIsEnabled = item.isEnabled !== undefined ? item.isEnabled : true;
            TempData[0].data.additionalFields[ItemName] = {
                displayName: ItemName,
                field: ItemField,
                isEnabled: ItemIsEnabled,
            };
        });
    }
    // setFilterConfig(TempData);
    return TempData;
}
function isEnabled(filterConfig, itemName) {
    let isEnable = true;
    const Keys = Object.keys(filterConfig);
    Keys.map((item) => {
        if (item.toLowerCase() === itemName.toLowerCase()) {
            isEnable = filterConfig[item].isEnabled;
        }
    });
    return isEnable;
}
export function FilterDataExtract({ content, filterConfig, TermsObject, }) {
    var _a, _b;
    const AddtionalFieldsObject = (_a = filterConfig[0]) === null || _a === void 0 ? void 0 : _a.data.additionalFields;
    const FilterConfigObject = Object.assign({}, AddtionalFieldsObject);
    let OptionNameArray = [];
    let OptionValueArray = [];
    if (filterConfig.length !== 0) {
        const AddtionalKeys = Object.keys((_b = filterConfig[0]) === null || _b === void 0 ? void 0 : _b.data.additionalFields);
        OptionNameArray = [...AddtionalKeys];
        OptionNameArray === null || OptionNameArray === void 0 ? void 0 : OptionNameArray.map((item) => {
            var _a;
            if (isEnabled(FilterConfigObject, item)) {
                let temp;
                if (TermsObject.hasOwnProperty(item)) {
                    temp = TermsObject[item];
                }
                else {
                    let fieldName = (_a = AddtionalFieldsObject[item]) === null || _a === void 0 ? void 0 : _a.field;
                    temp = new Set('');
                    if (fieldName !== null || fieldName !== undefined) {
                        content.map((item) => {
                            if (item[fieldName] !== null || item[fieldName] !== undefined) {
                                if (Array.isArray(item[fieldName])) {
                                    item[fieldName].map((ele) => {
                                        temp.add(ele);
                                    });
                                }
                                else {
                                    temp.add(item[fieldName]);
                                }
                            }
                        });
                    }
                }
                if (Array.isArray(temp)) {
                    if (temp.length !== 0)
                        OptionValueArray.push({
                            name: item,
                            terms: temp.sort(),
                        });
                }
                else {
                    const val = Array.from(temp);
                    val.splice(val.length - 1, 1);
                    if (val.length !== 0)
                        OptionValueArray.push({
                            name: item,
                            terms: val.sort(),
                        });
                }
            }
        });
    }
    return {
        OptionNameArray,
        OptionValueArray,
    };
}
export function RenderContentFunction({ content, filtersSelected, filterConfig, }) {
    var _a;
    const AddtionalFieldsObject = (_a = filterConfig[0]) === null || _a === void 0 ? void 0 : _a.data.additionalFields;
    const FilterConfigObject = Object.assign({}, AddtionalFieldsObject);
    const keys = Object.keys(FilterConfigObject);
    let contentArray = [];
    const tempContent = content;
    filtersSelected === null || filtersSelected === void 0 ? void 0 : filtersSelected.map((item) => {
        const itemName = item.name;
        const filterSelectedArray = item.value;
        const fieldKey = keys.filter((item) => {
            return item.toLowerCase() === (itemName === null || itemName === void 0 ? void 0 : itemName.toLowerCase());
        });
        const fieldObj = FilterConfigObject[fieldKey[0]];
        const field = fieldObj === null || fieldObj === void 0 ? void 0 : fieldObj.field;
        tempContent === null || tempContent === void 0 ? void 0 : tempContent.map((item) => {
            if (item[field] !== undefined) {
                filterSelectedArray.map((ele) => {
                    if (item[field].includes(ele)) {
                        contentArray.push(item);
                    }
                });
            }
        });
    });
    return contentArray;
}
function isArray(item) {
    if (Array.isArray(item)) {
        return item[0];
    }
    else {
        return item;
    }
}
export function CardFieldsRender(item, CardFieldsObject) {
    const FieldKeys = Object.keys(CardFieldsObject);
    let ObjectReturn = {};
    let tagsArray = [];
    FieldKeys.map((Field) => {
        if (item.hasOwnProperty(CardFieldsObject[Field].field)) {
            ObjectReturn[Field] = isArray(item[CardFieldsObject[Field].field]);
        }
        if (Field === 'tags') {
            const TagsFieldsArray = CardFieldsObject[Field].TagsFieldArray;
            TagsFieldsArray.map((tagField) => {
                if (item.hasOwnProperty(tagField))
                    tagsArray.push(isArray(item[tagField]));
            });
        }
    });
    ObjectReturn['tags'] = tagsArray;
    return ObjectReturn;
}
export function TermsFetch(data, 
// setMasterFieldsTerms: Function,
FilterConfig) {
    const Categories = data.result.framework.categories;
    const TermsObject = {};
    Categories.map((item) => {
        var _a;
        const name = item.name;
        if ((_a = FilterConfig[0].data.PrimaryFields[name]) === null || _a === void 0 ? void 0 : _a.isEnabled) {
            const associations = item.terms[0].associations
                ? item.terms[0].associations
                : item.terms;
            associations.map((item) => {
                if (TermsObject.hasOwnProperty(item.category)) {
                    let tempArr = TermsObject[item.category].terms;
                    tempArr.push(item.name);
                    const newSet = new Set(tempArr);
                    TermsObject[item.category].terms = Array.from(newSet);
                }
                else {
                    TermsObject[item.category] = {
                        name: item.category,
                        terms: [item.name],
                    };
                }
            });
        }
    });
    return [TermsObject];
}
export function MasterFieldContentChange(filtersArray, filterConfig, body) {
    const bodyJSON = JSON.parse(body);
    const TempObj = {};
    filtersArray.map((item) => {
        var _a;
        const itemName = item.name.toLowerCase();
        const configfiled = filterConfig.filter((fil) => {
            return fil.name.toLowerCase() === itemName;
        });
        TempObj[(_a = configfiled[0]) === null || _a === void 0 ? void 0 : _a.field] = item.value;
    });
    const keys = Object.keys(bodyJSON.request.filters);
    keys.map((item) => {
        if (TempObj[item] !== undefined) {
            bodyJSON.request.filters[item] = TempObj[item];
        }
    });
    return JSON.stringify(bodyJSON);
}
export function DependentTermsFetch(thing, filters, filterOptions) {
    var _a;
    let obj = {};
    (_a = thing.result.framework.categories) === null || _a === void 0 ? void 0 : _a.map((item) => {
        filters === null || filters === void 0 ? void 0 : filters.map((filter) => {
            if (item.code.toLowerCase() === filter.name.toLowerCase()) {
                const arr = filter.value;
                item.terms.map((item) => {
                    if (arr.includes(item.name)) {
                        item.associations.map((item) => {
                            if (obj[item.category] === undefined) {
                                obj[item.category] = [item.name];
                            }
                            else {
                                // Concatenate the existing values with the new item's name
                                const concatenatedValues = obj[item.category].concat(item.name);
                                // Convert the concatenated values into a Set to remove duplicates
                                const uniqueValuesSet = new Set(concatenatedValues);
                                // Convert the Set back into an array using Array.from()
                                const uniqueValuesArray = Array.from(uniqueValuesSet);
                                obj[item.category] = uniqueValuesArray.sort();
                            }
                        });
                    }
                });
            }
        });
    });
    const Keys = Object.keys(filterOptions[0]);
    Keys.map((item) => {
        if (obj.hasOwnProperty(item)) {
            filterOptions[0][item].terms = obj[item];
        }
    });
    return filterOptions;
}
export function FrameworksOptionsRender(Frameworks) {
    let options = [];
    Frameworks === null || Frameworks === void 0 ? void 0 : Frameworks.map((item) => {
        options.push(item.name);
    });
    return options;
}
export function GetFrameWorkID(Frameworks, Framework) {
    let id = '';
    Frameworks === null || Frameworks === void 0 ? void 0 : Frameworks.map((item) => {
        if (item.name === Framework) {
            id = item.identifier;
        }
    });
    return id;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2VydmljZV9GdW5jdGlvbnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9maWx0ZXJpbmcvc3JjL2xpYi9GdW5jdGlvbnMvU2VydmljZV9GdW5jdGlvbnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBTUEsTUFBTSxVQUFVLFlBQVksQ0FBQyxFQUMzQixPQUFPLEVBQ1AscUJBQXFCLEVBQ3JCLFlBQVksR0FDTTtJQUNsQixJQUFJLFFBQVEsR0FBRyxPQUFPLENBQUM7SUFDdkIsSUFBSSxDQUFBLFlBQVksYUFBWixZQUFZLHVCQUFaLFlBQVksQ0FBRSxNQUFNLE1BQUssQ0FBQyxFQUFFO1FBQzlCLFlBQVksYUFBWixZQUFZLHVCQUFaLFlBQVksQ0FBRSxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRTtZQUN6QixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1lBQzNCLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7WUFDN0IsTUFBTSxhQUFhLEdBQ2pCLElBQUksQ0FBQyxTQUFTLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7WUFDdkQsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLEdBQUc7Z0JBQ3pDLEtBQUssRUFBRSxTQUFTO2dCQUNoQixTQUFTLEVBQUUsYUFBYTthQUN6QixDQUFDO1FBQ0osQ0FBQyxFQUFFO0tBQ0o7SUFDRCxJQUFJLENBQUEscUJBQXFCLGFBQXJCLHFCQUFxQix1QkFBckIscUJBQXFCLENBQUUsTUFBTSxNQUFLLENBQUMsRUFBRTtRQUN2QyxxQkFBcUIsYUFBckIscUJBQXFCLHVCQUFyQixxQkFBcUIsQ0FBRSxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRTtZQUNsQyxNQUFNLFFBQVEsR0FBRyxJQUFJLENB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QUFHLENBQUMsQ0FBQyxJQUFTLEVBQUUsRUFBRTtRQUM1QixJQUFJLElBQUksQ0FBQyxJQUFJLEtBQUssU0FBUyxFQUFFO1lBQzNCLEVBQUUsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDO1NBQ3RCO0lBQ0gsQ0FBQyxFQUFFO0lBQ0gsT0FBTyxFQUFFLENBQUM7QUFDWixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBTZXJ2aWNlRnVuY3Rpb25DYXJkUHJvcHMsXHJcbiAgRmlsdGVyRGF0YUV4dHJhY3RQcm9wcyxcclxuICBSZW5kZXJDb250ZW50UHJvcHMsXHJcbiAgVXBkYXRlQ29uZmlnUHJvcHMsXHJcbn0gZnJvbSAnLi4vSW50ZXJmYWNlcy9TZXJ2aWNlX0Z1bmN0aW9uX0ludGVyZmFjZXMnO1xyXG5leHBvcnQgZnVuY3Rpb24gVXBkYXRlQ29uZmlnKHtcclxuICBhcGlEYXRhLFxyXG4gIGFkZHRpb25hbEZpbHRlckNvbmZpZyxcclxuICBmaWx0ZXJDb25maWcsXHJcbn06IFVwZGF0ZUNvbmZpZ1Byb3BzKSB7XHJcbiAgbGV0IFRlbXBEYXRhID0gYXBpRGF0YTtcclxuICBpZiAoZmlsdGVyQ29uZmlnPy5sZW5ndGggIT09IDApIHtcclxuICAgIGZpbHRlckNvbmZpZz8ubWFwKChpdGVtKSA9PiB7XHJcbiAgICAgIGNvbnN0IEl0ZW1OYW1lID0gaXRlbS5uYW1lO1xyXG4gICAgICBjb25zdCBJdGVtRmllbGQgPSBpdGVtLmZpZWxkO1xyXG4gICAgICBjb25zdCBJdGVtSXNFbmFibGVkID1cclxuICAgICAgICBpdGVtLmlzRW5hYmxlZCAhPT0gdW5kZWZpbmVkID8gaXRlbS5pc0VuYWJsZWQgOiB0cnVlO1xyXG4gICAgICBUZW1wRGF0YVswXS5kYXRhLlByaW1hcnlGaWVsZHNbSXRlbU5hbWVdID0ge1xyXG4gICAgICAgIGZpZWxkOiBJdGVtRmllbGQsXHJcbiAgICAgICAgaXNFbmFibGVkOiBJdGVtSXNFbmFibGVkLFxyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGlmIChhZGR0aW9uYWxGaWx0ZXJDb25maWc/Lmxlbmd0aCAhPT0gMCkge1xyXG4gICAgYWRkdGlvbmFsRmlsdGVyQ29uZmlnPy5tYXAoKGl0ZW0pID0+IHtcclxuICAgICAgY29uc3QgSXRlbU5hbWUgPSBpdGVtLm5hbWU7XHJcbiAgICAgIGNvbnN0IEl0ZW1GaWVsZCA9IGl0ZW0uZmllbGQ7XHJcbiAgICAgIGNvbnN0IEl0ZW1Jc0VuYWJsZWQgPVxyXG4gICAgICAgIGl0ZW0uaXNFbmFibGVkICE9PSB1bmRlZmluZWQgPyBpdGVtLmlzRW5hYmxlZCA6IHRydWU7XHJcbiAgICAgIFRlbXBEYXRhWzBdLmRhdGEuYWRkaXRpb25hbEZpZWxkc1tJdGVtTmFtZV0gPSB7XHJcbiAgICAgICAgZGlzcGxheU5hbWU6IEl0ZW1OYW1lLFxyXG4gICAgICAgIGZpZWxkOiBJdGVtRmllbGQsXHJcbiAgICAgICAgaXNFbmFibGVkOiBJdGVtSXNFbmFibGVkLFxyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8vIHNldEZpbHRlckNvbmZpZyhUZW1wRGF0YSk7XHJcbiAgcmV0dXJuIFRlbXBEYXRhO1xyXG59XHJcblxyXG5mdW5jdGlvbiBpc0VuYWJsZWQoZmlsdGVyQ29uZmlnOiBhbnksIGl0ZW1OYW1lOiBzdHJpbmcpIHtcclxuICBsZXQgaXNFbmFibGUgPSB0cnVlO1xyXG4gIGNvbnN0IEtleXMgPSBPYmplY3Qua2V5cyhmaWx0ZXJDb25maWcpO1xyXG4gIEtleXMubWFwKChpdGVtKSA9PiB7XHJcbiAgICBpZiAoaXRlbS50b0xvd2VyQ2FzZSgpID09PSBpdGVtTmFtZS50b0xvd2VyQ2FzZSgpKSB7XHJcbiAgICAgIGlzRW5hYmxlID0gZmlsdGVyQ29uZmlnW2l0ZW1dLmlzRW5hYmxlZDtcclxuICAgIH1cclxuICB9KTtcclxuICByZXR1cm4gaXNFbmFibGU7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBGaWx0ZXJEYXRhRXh0cmFjdCh7XHJcbiAgY29udGVudCxcclxuICBmaWx0ZXJDb25maWcsXHJcbiAgVGVybXNPYmplY3QsXHJcbn06IEZpbHRlckRhdGFFeHRyYWN0UHJvcHMpIHtcclxuICBjb25zdCBBZGR0aW9uYWxGaWVsZHNPYmplY3QgPSBmaWx0ZXJDb25maWdbMF0/LmRhdGEuYWRkaXRpb25hbEZpZWxkcztcclxuXHJcbiAgY29uc3QgRmlsdGVyQ29uZmlnT2JqZWN0ID0ge1xyXG4gICAgLi4uQWRkdGlvbmFsRmllbGRzT2JqZWN0LFxyXG4gIH07XHJcbiAgbGV0IE9wdGlvbk5hbWVBcnJheTogYW55ID0gW107XHJcbiAgbGV0IE9wdGlvblZhbHVlQXJyYXk6IGFueSA9IFtdO1xyXG4gIGlmIChmaWx0ZXJDb25maWcubGVuZ3RoICE9PSAwKSB7XHJcbiAgICBjb25zdCBBZGR0aW9uYWxLZXlzID0gT2JqZWN0LmtleXMoZmlsdGVyQ29uZmlnWzBdPy5kYXRhLmFkZGl0aW9uYWxGaWVsZHMpO1xyXG4gICAgT3B0aW9uTmFtZUFycmF5ID0gWy4uLkFkZHRpb25hbEtleXNdO1xyXG4gICAgT3B0aW9uTmFtZUFycmF5Py5tYXAoKGl0ZW06IGFueSkgPT4ge1xyXG4gICAgICBpZiAoaXNFbmFibGVkKEZpbHRlckNvbmZpZ09iamVjdCwgaXRlbSkpIHtcclxuICAgICAgICBsZXQgdGVtcDogYW55O1xyXG4gICAgICAgIGlmIChUZXJtc09iamVjdC5oYXNPd25Qcm9wZXJ0eShpdGVtKSkge1xyXG4gICAgICAgICAgdGVtcCA9IFRlcm1zT2JqZWN0W2l0ZW1dO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBsZXQgZmllbGROYW1lID0gQWRkdGlvbmFsRmllbGRzT2JqZWN0W2l0ZW1dPy5maWVsZDtcclxuXHJcbiAgICAgICAgICB0ZW1wID0gbmV3IFNldCgnJyk7XHJcblxyXG4gICAgICAgICAgaWYgKGZpZWxkTmFtZSAhPT0gbnVsbCB8fCBmaWVsZE5hbWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBjb250ZW50Lm1hcCgoaXRlbTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgaWYgKGl0ZW1bZmllbGROYW1lXSAhPT0gbnVsbCB8fCBpdGVtW2ZpZWxkTmFtZV0gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaXRlbVtmaWVsZE5hbWVdKSkge1xyXG4gICAgICAgICAgICAgICAgICBpdGVtW2ZpZWxkTmFtZV0ubWFwKChlbGU6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRlbXAuYWRkKGVsZSk7XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgdGVtcC5hZGQoaXRlbVtmaWVsZE5hbWVdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh0ZW1wKSkge1xyXG4gICAgICAgICAgaWYgKHRlbXAubGVuZ3RoICE9PSAwKVxyXG4gICAgICAgICAgICBPcHRpb25WYWx1ZUFycmF5LnB1c2goe1xyXG4gICAgICAgICAgICAgIG5hbWU6IGl0ZW0sXHJcbiAgICAgICAgICAgICAgdGVybXM6IHRlbXAuc29ydCgpLFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgY29uc3QgdmFsID0gQXJyYXkuZnJvbSh0ZW1wKTtcclxuICAgICAgICAgIHZhbC5zcGxpY2UodmFsLmxlbmd0aCAtIDEsIDEpO1xyXG4gICAgICAgICAgaWYgKHZhbC5sZW5ndGggIT09IDApXHJcbiAgICAgICAgICAgIE9wdGlvblZhbHVlQXJyYXkucHVzaCh7XHJcbiAgICAgICAgICAgICAgbmFtZTogaXRlbSxcclxuICAgICAgICAgICAgICB0ZXJtczogdmFsLnNvcnQoKSxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbiAgcmV0dXJuIHtcclxuICAgIE9wdGlvbk5hbWVBcnJheSxcclxuICAgIE9wdGlvblZhbHVlQXJyYXksXHJcbiAgfTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIFJlbmRlckNvbnRlbnRGdW5jdGlvbih7XHJcbiAgY29udGVudCxcclxuICBmaWx0ZXJzU2VsZWN0ZWQsXHJcbiAgZmlsdGVyQ29uZmlnLFxyXG59OiBSZW5kZXJDb250ZW50UHJvcHMpIHtcclxuICBjb25zdCBBZGR0aW9uYWxGaWVsZHNPYmplY3QgPSBmaWx0ZXJDb25maWdbMF0/LmRhdGEuYWRkaXRpb25hbEZpZWxkcztcclxuICBjb25zdCBGaWx0ZXJDb25maWdPYmplY3QgPSB7XHJcbiAgICAuLi5BZGR0aW9uYWxGaWVsZHNPYmplY3QsXHJcbiAgfTtcclxuICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoRmlsdGVyQ29uZmlnT2JqZWN0KTtcclxuICBsZXQgY29udGVudEFycmF5OiBBcnJheTxhbnk+ID0gW107XHJcbiAgY29uc3QgdGVtcENvbnRlbnQgPSBjb250ZW50O1xyXG4gIGZpbHRlcnNTZWxlY3RlZD8ubWFwKChpdGVtOiBhbnkpID0+IHtcclxuICAgIGNvbnN0IGl0ZW1OYW1lID0gaXRlbS5uYW1lO1xyXG4gICAgY29uc3QgZmlsdGVyU2VsZWN0ZWRBcnJheSA9IGl0ZW0udmFsdWU7XHJcbiAgICBjb25zdCBmaWVsZEtleSA9IGtleXMuZmlsdGVyKChpdGVtKSA9PiB7XHJcbiAgICAgIHJldHVybiBpdGVtLnRvTG93ZXJDYXNlKCkgPT09IGl0ZW1OYW1lPy50b0xvd2VyQ2FzZSgpO1xyXG4gICAgfSk7XHJcbiAgICBjb25zdCBmaWVsZE9iaiA9IEZpbHRlckNvbmZpZ09iamVjdFtmaWVsZEtleVswXV07XHJcbiAgICBjb25zdCBmaWVsZCA9IGZpZWxkT2JqPy5maWVsZDtcclxuICAgIHRlbXBDb250ZW50Py5tYXAoKGl0ZW06IGFueSkgPT4ge1xyXG4gICAgICBpZiAoaXRlbVtmaWVsZF0gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIGZpbHRlclNlbGVjdGVkQXJyYXkubWFwKChlbGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgaWYgKGl0ZW1bZmllbGRdLmluY2x1ZGVzKGVsZSkpIHtcclxuICAgICAgICAgICAgY29udGVudEFycmF5LnB1c2goaXRlbSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH0pO1xyXG4gIHJldHVybiBjb250ZW50QXJyYXk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGlzQXJyYXkoaXRlbTogYW55KSB7XHJcbiAgaWYgKEFycmF5LmlzQXJyYXkoaXRlbSkpIHtcclxuICAgIHJldHVybiBpdGVtWzBdO1xyXG4gIH0gZWxzZSB7XHJcbiAgICByZXR1cm4gaXRlbTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBDYXJkRmllbGRzUmVuZGVyKGl0ZW06IGFueSwgQ2FyZEZpZWxkc09iamVjdDogYW55KSB7XHJcbiAgY29uc3QgRmllbGRLZXlzID0gT2JqZWN0LmtleXMoQ2FyZEZpZWxkc09iamVjdCk7XHJcbiAgbGV0IE9iamVjdFJldHVybjogU2VydmljZUZ1bmN0aW9uQ2FyZFByb3BzID0ge307XHJcbiAgbGV0IHRhZ3NBcnJheTogQXJyYXk8c3RyaW5nPiA9IFtdO1xyXG4gIEZpZWxkS2V5cy5tYXAoKEZpZWxkOiBzdHJpbmcpID0+IHtcclxuICAgIGlmIChpdGVtLmhhc093blByb3BlcnR5KENhcmRGaWVsZHNPYmplY3RbRmllbGRdLmZpZWxkKSkge1xyXG4gICAgICBPYmplY3RSZXR1cm5bRmllbGQgYXMga2V5b2YgU2VydmljZUZ1bmN0aW9uQ2FyZFByb3BzXSA9IGlzQXJyYXkoXHJcbiAgICAgICAgaXRlbVtDYXJkRmllbGRzT2JqZWN0W0ZpZWxkXS5maWVsZF1cclxuICAgICAgKTtcclxuICAgIH1cclxuICAgIGlmIChGaWVsZCA9PT0gJ3RhZ3MnKSB7XHJcbiAgICAgIGNvbnN0IFRhZ3NGaWVsZHNBcnJheSA9IENhcmRGaWVsZHNPYmplY3RbRmllbGRdLlRhZ3NGaWVsZEFycmF5O1xyXG4gICAgICBUYWdzRmllbGRzQXJyYXkubWFwKCh0YWdGaWVsZDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgaWYgKGl0ZW0uaGFzT3duUHJvcGVydHkodGFnRmllbGQpKVxyXG4gICAgICAgICAgdGFnc0FycmF5LnB1c2goaXNBcnJheShpdGVtW3RhZ0ZpZWxkXSkpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9KTtcclxuICBPYmplY3RSZXR1cm5bJ3RhZ3MnXSA9IHRhZ3NBcnJheTtcclxuICByZXR1cm4gT2JqZWN0UmV0dXJuO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gVGVybXNGZXRjaChcclxuICBkYXRhOiBhbnksXHJcbiAgLy8gc2V0TWFzdGVyRmllbGRzVGVybXM6IEZ1bmN0aW9uLFxyXG4gIEZpbHRlckNvbmZpZz86IGFueVxyXG4pIHtcclxuICBjb25zdCBDYXRlZ29yaWVzID0gZGF0YS5yZXN1bHQuZnJhbWV3b3JrLmNhdGVnb3JpZXM7XHJcbiAgY29uc3QgVGVybXNPYmplY3Q6IGFueSA9IHt9O1xyXG4gIENhdGVnb3JpZXMubWFwKChpdGVtOiBhbnkpID0+IHtcclxuICAgIGNvbnN0IG5hbWUgPSBpdGVtLm5hbWU7XHJcbiAgICBpZiAoRmlsdGVyQ29uZmlnWzBdLmRhdGEuUHJpbWFyeUZpZWxkc1tuYW1lXT8uaXNFbmFibGVkKSB7XHJcbiAgICAgIGNvbnN0IGFzc29jaWF0aW9ucyA9IGl0ZW0udGVybXNbMF0uYXNzb2NpYXRpb25zXHJcbiAgICAgICAgPyBpdGVtLnRlcm1zWzBdLmFzc29jaWF0aW9uc1xyXG4gICAgICAgIDogaXRlbS50ZXJtcztcclxuICAgICAgYXNzb2NpYXRpb25zLm1hcCgoaXRlbTogYW55KSA9PiB7XHJcbiAgICAgICAgaWYgKFRlcm1zT2JqZWN0Lmhhc093blByb3BlcnR5KGl0ZW0uY2F0ZWdvcnkpKSB7XHJcbiAgICAgICAgICBsZXQgdGVtcEFyciA9IFRlcm1zT2JqZWN0W2l0ZW0uY2F0ZWdvcnkgYXMga2V5b2YgYW55XS50ZXJtcztcclxuICAgICAgICAgIHRlbXBBcnIucHVzaChpdGVtLm5hbWUpO1xyXG4gICAgICAgICAgY29uc3QgbmV3U2V0ID0gbmV3IFNldCh0ZW1wQXJyKTtcclxuICAgICAgICAgIFRlcm1zT2JqZWN0W2l0ZW0uY2F0ZWdvcnkgYXMga2V5b2YgYW55XS50ZXJtcyA9IEFycmF5LmZyb20obmV3U2V0KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgVGVybXNPYmplY3RbaXRlbS5jYXRlZ29yeSBhcyBrZXlvZiBhbnldID0ge1xyXG4gICAgICAgICAgICBuYW1lOiBpdGVtLmNhdGVnb3J5LFxyXG4gICAgICAgICAgICB0ZXJtczogW2l0ZW0ubmFtZV0sXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbiAgcmV0dXJuIFtUZXJtc09iamVjdF07XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBNYXN0ZXJGaWVsZENvbnRlbnRDaGFuZ2UoXHJcbiAgZmlsdGVyc0FycmF5OiBhbnksXHJcbiAgZmlsdGVyQ29uZmlnOiBhbnksXHJcbiAgYm9keTogc3RyaW5nXHJcbikge1xyXG4gIGNvbnN0IGJvZHlKU09OID0gSlNPTi5wYXJzZShib2R5KTtcclxuICBjb25zdCBUZW1wT2JqOiBhbnkgPSB7fTtcclxuXHJcbiAgZmlsdGVyc0FycmF5Lm1hcCgoaXRlbTogYW55KSA9PiB7XHJcbiAgICBjb25zdCBpdGVtTmFtZSA9IGl0ZW0ubmFtZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgY29uc3QgY29uZmlnZmlsZWQgPSBmaWx0ZXJDb25maWcuZmlsdGVyKChmaWw6IGFueSkgPT4ge1xyXG4gICAgICByZXR1cm4gZmlsLm5hbWUudG9Mb3dlckNhc2UoKSA9PT0gaXRlbU5hbWU7XHJcbiAgICB9KTtcclxuICAgIFRlbXBPYmpbY29uZmlnZmlsZWRbMF0/LmZpZWxkXSA9IGl0ZW0udmFsdWU7XHJcbiAgfSk7XHJcbiAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGJvZHlKU09OLnJlcXVlc3QuZmlsdGVycyk7XHJcbiAga2V5cy5tYXAoKGl0ZW06IGFueSkgPT4ge1xyXG4gICAgaWYgKFRlbXBPYmpbaXRlbV0gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBib2R5SlNPTi5yZXF1ZXN0LmZpbHRlcnNbaXRlbV0gPSBUZW1wT2JqW2l0ZW1dO1xyXG4gICAgfVxyXG4gIH0pO1xyXG4gIHJldHVybiBKU09OLnN0cmluZ2lmeShib2R5SlNPTik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBEZXBlbmRlbnRUZXJtc0ZldGNoKFxyXG4gIHRoaW5nOiBhbnksXHJcbiAgZmlsdGVyczogYW55LFxyXG4gIGZpbHRlck9wdGlvbnM6IGFueVxyXG4pIHtcclxuICBsZXQgb2JqOiBhbnkgPSB7fTtcclxuICB0aGluZy5yZXN1bHQuZnJhbWV3b3JrLmNhdGVnb3JpZXM/Lm1hcCgoaXRlbTogYW55KSA9PiB7XHJcbiAgICBmaWx0ZXJzPy5tYXAoKGZpbHRlcjogYW55KSA9PiB7XHJcbiAgICAgIGlmIChpdGVtLmNvZGUudG9Mb3dlckNhc2UoKSA9PT0gZmlsdGVyLm5hbWUudG9Mb3dlckNhc2UoKSkge1xyXG4gICAgICAgIGNvbnN0IGFyciA9IGZpbHRlci52YWx1ZTtcclxuICAgICAgICBpdGVtLnRlcm1zLm1hcCgoaXRlbTogYW55KSA9PiB7XHJcbiAgICAgICAgICBpZiAoYXJyLmluY2x1ZGVzKGl0ZW0ubmFtZSkpIHtcclxuICAgICAgICAgICAgaXRlbS5hc3NvY2lhdGlvbnMubWFwKChpdGVtOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICBpZiAob2JqW2l0ZW0uY2F0ZWdvcnldID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIG9ialtpdGVtLmNhdGVnb3J5XSA9IFtpdGVtLm5hbWVdO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBDb25jYXRlbmF0ZSB0aGUgZXhpc3RpbmcgdmFsdWVzIHdpdGggdGhlIG5ldyBpdGVtJ3MgbmFtZVxyXG4gICAgICAgICAgICAgICAgY29uc3QgY29uY2F0ZW5hdGVkVmFsdWVzID0gb2JqW2l0ZW0uY2F0ZWdvcnldLmNvbmNhdChpdGVtLm5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIENvbnZlcnQgdGhlIGNvbmNhdGVuYXRlZCB2YWx1ZXMgaW50byBhIFNldCB0byByZW1vdmUgZHVwbGljYXRlc1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdW5pcXVlVmFsdWVzU2V0ID0gbmV3IFNldChjb25jYXRlbmF0ZWRWYWx1ZXMpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIENvbnZlcnQgdGhlIFNldCBiYWNrIGludG8gYW4gYXJyYXkgdXNpbmcgQXJyYXkuZnJvbSgpXHJcbiAgICAgICAgICAgICAgICBjb25zdCB1bmlxdWVWYWx1ZXNBcnJheSA9IEFycmF5LmZyb20odW5pcXVlVmFsdWVzU2V0KTtcclxuXHJcbiAgICAgICAgICAgICAgICBvYmpbaXRlbS5jYXRlZ29yeV0gPSB1bmlxdWVWYWx1ZXNBcnJheS5zb3J0KCk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfSk7XHJcbiAgY29uc3QgS2V5cyA9IE9iamVjdC5rZXlzKGZpbHRlck9wdGlvbnNbMF0pO1xyXG4gIEtleXMubWFwKChpdGVtOiBhbnkpID0+IHtcclxuICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoaXRlbSkpIHtcclxuICAgICAgZmlsdGVyT3B0aW9uc1swXVtpdGVtXS50ZXJtcyA9IG9ialtpdGVtXTtcclxuICAgIH1cclxuICB9KTtcclxuICByZXR1cm4gZmlsdGVyT3B0aW9ucztcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIEZyYW1ld29ya3NPcHRpb25zUmVuZGVyKEZyYW1ld29ya3M6IEFycmF5PGFueT4pIHtcclxuICBsZXQgb3B0aW9uczogQXJyYXk8c3RyaW5nPiA9IFtdO1xyXG4gIEZyYW1ld29ya3M/Lm1hcCgoaXRlbTogYW55KSA9PiB7XHJcbiAgICBvcHRpb25zLnB1c2goaXRlbS5uYW1lKTtcclxuICB9KTtcclxuICByZXR1cm4gb3B0aW9ucztcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIEdldEZyYW1lV29ya0lEKEZyYW1ld29ya3M6IEFycmF5PGFueT4sIEZyYW1ld29yazogc3RyaW5nKSB7XHJcbiAgbGV0IGlkOiBzdHJpbmcgPSAnJztcclxuICBGcmFtZXdvcmtzPy5tYXAoKGl0ZW06IGFueSkgPT4ge1xyXG4gICAgaWYgKGl0ZW0ubmFtZSA9PT0gRnJhbWV3b3JrKSB7XHJcbiAgICAgIGlkID0gaXRlbS5pZGVudGlmaWVyO1xyXG4gICAgfVxyXG4gIH0pO1xyXG4gIHJldHVybiBpZDtcclxufVxyXG4iXX0=